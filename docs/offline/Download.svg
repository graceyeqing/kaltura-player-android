<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1073px" preserveAspectRatio="none" style="width:917px;height:1073px;" version="1.1" viewBox="0 0 917 1073" width="917px" zoomAndPan="magnify"><defs><filter height="300%" id="f1q9by9i9niz19" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="155" x2="155" y1="38.4883" y2="1032.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="584" x2="584" y1="38.4883" y2="1032.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="726" x2="726" y1="38.4883" y2="1032.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="853" x2="853" y1="38.4883" y2="1032.8047"/><rect fill="#E0FFFF" filter="url(#f1q9by9i9niz19)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="132" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="139" y="23.5352">App</text><rect fill="#E0FFFF" filter="url(#f1q9by9i9niz19)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="132" y="1031.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="139" y="1052.3398">App</text><rect fill="#FEFECE" filter="url(#f1q9by9i9niz19)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="522" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="529" y="23.5352">OfflineManager</text><rect fill="#FEFECE" filter="url(#f1q9by9i9niz19)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="522" y="1031.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="529" y="1052.3398">OfflineManager</text><rect fill="#FEFECE" filter="url(#f1q9by9i9niz19)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="137" x="656" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="663" y="23.5352">OVPMediaOptions</text><rect fill="#FEFECE" filter="url(#f1q9by9i9niz19)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="137" x="656" y="1031.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="663" y="1052.3398">OVPMediaOptions</text><rect fill="#FEFECE" filter="url(#f1q9by9i9niz19)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="807" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="814" y="23.5352">MediaPrefs</text><rect fill="#FEFECE" filter="url(#f1q9by9i9niz19)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="807" y="1031.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="814" y="1052.3398">MediaPrefs</text><rect fill="#EEEEEE" filter="url(#f1q9by9i9niz19)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="902" x="3" y="69.1436"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="69.1436" y2="69.1436"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="72.1436" y2="72.1436"/><rect fill="#EEEEEE" filter="url(#f1q9by9i9niz19)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="118" x="395" y="58.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="401" y="75.0566">Add new entry</text><polygon fill="#A80036" points="714.5,108.7988,724.5,112.7988,714.5,116.7988,718.5,112.7988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="720.5" y1="112.7988" y2="112.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="162" y="108.3672">new(entryId, ks)</text><polygon fill="#A80036" points="714.5,138.1094,724.5,142.1094,714.5,146.1094,718.5,142.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="720.5" y1="142.1094" y2="142.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="162" y="137.6777">loadMedia(url, pid)</text><path d="M646,162.4199 L646,173.4199 A7,7 0 0 0 653,180.4199 L795,180.4199 A7,7 0 0 0 802,173.4199 L802,165.4199 L792,155.4199 L653,155.4199 A7,7 0 0 0 646,162.4199 " fill="#FFFF00" filter="url(#f1q9by9i9niz19)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M792,155.4199 L792,161.9199 A3.5,3.5 0 0 0 795.5,165.4199 L802,165.4199 L792,155.4199 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="652" y="172.9883">Contacts</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="75" x="712" y="172.9883">Kaltura API</text><polygon fill="#A80036" points="166,206.7305,156,210.7305,166,214.7305,162,210.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="160" x2="725.5" y1="210.7305" y2="210.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="172" y="206.2988">mediaEntry</text><polygon fill="#A80036" points="572,236.041,582,240.041,572,244.041,576,240.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="578" y1="240.041" y2="240.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="162" y="235.6094">addAsset(mediaEntry)</text><path d="M425,260.3516 L425,271.3516 A7,7 0 0 0 432,278.3516 L731,278.3516 A7,7 0 0 0 738,271.3516 L738,263.3516 L728,253.3516 L432,253.3516 A7,7 0 0 0 425,260.3516 " fill="#FFFF00" filter="url(#f1q9by9i9niz19)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M728,253.3516 L728,259.8516 A3.5,3.5 0 0 0 731.5,263.3516 L738,263.3516 L728,253.3516 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="431" y="270.9199">Selects a MediaSource that matches the device</text><rect fill="#EEEEEE" filter="url(#f1q9by9i9niz19)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="902" x="3" y="308.3174"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="308.3174" y2="308.3174"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="311.3174" y2="311.3174"/><rect fill="#EEEEEE" filter="url(#f1q9by9i9niz19)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="255" x="326.5" y="297.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="237" x="332.5" y="314.2305">Set media prefs and load asset info</text><path d="M61,342.9727 L61,353.9727 A7,7 0 0 0 68,360.9727 L237,360.9727 A7,7 0 0 0 244,353.9727 L244,345.9727 L234,335.9727 L68,335.9727 A7,7 0 0 0 61,342.9727 " fill="#FFFF00" filter="url(#f1q9by9i9niz19)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M234,335.9727 L234,342.4727 A3.5,3.5 0 0 0 237.5,345.9727 L244,345.9727 L234,335.9727 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="67" y="353.541">Set media download prefs</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="197" y1="406.9043" y2="406.9043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="197" y1="406.9043" y2="419.9043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="156" x2="197" y1="419.9043" y2="419.9043"/><polygon fill="#A80036" points="166,415.9043,156,419.9043,166,423.9043,162,419.9043" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="391" x="162" y="386.8516">prefs = new MediaPrefs(videoBitrate, videoHeight, videoWidth,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="166" y="402.1621">audioLangs, textLangs)</text><polygon fill="#A80036" points="572,444.9043,582,448.9043,572,452.9043,576,448.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="578" y1="448.9043" y2="448.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="162" y="444.4727">loadAssetDownloadInfo(entryId, prefs)</text><path d="M498,469.2148 L498,480.2148 A7,7 0 0 0 505,487.2148 L659,487.2148 A7,7 0 0 0 666,480.2148 L666,472.2148 L656,462.2148 L505,462.2148 A7,7 0 0 0 498,469.2148 " fill="#FFFF00" filter="url(#f1q9by9i9niz19)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M656,462.2148 L656,468.7148 A3.5,3.5 0 0 0 659.5,472.2148 L666,472.2148 L656,462.2148 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="504" y="479.7832">Contacts</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="564" y="479.7832">Content Host</text><path d="M432,508.5254 L432,519.5254 A7,7 0 0 0 439,526.5254 L724,526.5254 A7,7 0 0 0 731,519.5254 L731,511.5254 L721,501.5254 L439,501.5254 A7,7 0 0 0 432,508.5254 " fill="#FFFF00" filter="url(#f1q9by9i9niz19)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M721,501.5254 L721,508.0254 A3.5,3.5 0 0 0 724.5,511.5254 L731,511.5254 L721,501.5254 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="438" y="519.0938">Extracts available tracks, applies MediaPrefs</text><polygon fill="#A80036" points="166,552.8359,156,556.8359,166,560.8359,162,556.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="583" y1="556.8359" y2="556.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="172" y="552.4043">onTracksAvailable(entryId, available, selected, selector)</text><path d="M13,577.1465 L13,603.1465 A7,7 0 0 0 20,610.1465 L286,610.1465 A7,7 0 0 0 293,603.1465 L293,580.1465 L283,570.1465 L20,570.1465 A7,7 0 0 0 13,577.1465 " fill="#FFFF00" filter="url(#f1q9by9i9niz19)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M283,570.1465 L283,576.6465 A3.5,3.5 0 0 0 286.5,580.1465 L293,580.1465 L283,570.1465 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="19" y="587.7148">Inspect</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="55" x="69" y="587.7148">available</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="128" y="587.7148">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="52" x="155" y="587.7148">selected</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="207" y="587.7148">, optionally</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="23" y="603.0254">return a selection map</text><polygon fill="#A80036" points="572,636.7676,582,640.7676,572,644.7676,576,640.7676" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="578" y1="640.7676" y2="640.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="162" y="636.3359">selectedTracksMap</text><polygon fill="#A80036" points="166,666.0781,156,670.0781,166,674.0781,162,670.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="583" y1="670.0781" y2="670.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="172" y="665.6465">onAssetInfoUpdated(entryId, assetInfo[</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="418" y="665.6465">metadataLoaded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="532" y="665.6465">])</text><path d="M13,690.3887 L13,716.3887 A7,7 0 0 0 20,723.3887 L286,723.3887 A7,7 0 0 0 293,716.3887 L293,693.3887 L283,683.3887 L20,683.3887 A7,7 0 0 0 13,690.3887 " fill="#FFFF00" filter="url(#f1q9by9i9niz19)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M283,683.3887 L283,689.8887 A3.5,3.5 0 0 0 286.5,693.3887 L293,693.3887 L283,683.3887 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="19" y="700.957">Now AssetInfo is updated with estimated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="23" y="716.2676">size based on track selection</text><rect fill="#EEEEEE" filter="url(#f1q9by9i9niz19)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="902" x="3" y="753.665"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="753.665" y2="753.665"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="756.665" y2="756.665"/><rect fill="#EEEEEE" filter="url(#f1q9by9i9niz19)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="145" x="381.5" y="743.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="387.5" y="759.5781">Start the download</text><polygon fill="#A80036" points="572,793.3203,582,797.3203,572,801.3203,576,797.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="578" y1="797.3203" y2="797.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="162" y="792.8887">startAsset(entryId)</text><polygon fill="#A80036" points="166,822.6309,156,826.6309,166,830.6309,162,826.6309" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="583" y1="826.6309" y2="826.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="172" y="822.1992">onAssetInfoUpdated(entryId, assetInfo[</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="48" x="418" y="822.1992">started</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="466" y="822.1992">])</text><path d="M19,841.9414 L86,841.9414 L86,848.9414 L76,858.9414 L12,858.9414 L12,848.9414 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="101.2422" rx="7" ry="7" style="stroke: #000000; stroke-width: 2.0;" width="644" x="12" y="841.9414"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="27" y="855.5098">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="101" y="854.5762">[downloading]</text><polygon fill="#A80036" points="166,876.252,156,880.252,166,884.252,162,880.252" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="583" y1="880.252" y2="880.252"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="405" x="172" y="875.8203">onDownloadProgress(entryId, downloadedBytes, estimatedBytes)</text><path d="M22,900.5625 L22,926.5625 A7,7 0 0 0 29,933.5625 L276,933.5625 A7,7 0 0 0 283,926.5625 L283,903.5625 L273,893.5625 L29,893.5625 A7,7 0 0 0 22,900.5625 " fill="#FF6347" filter="url(#f1q9by9i9niz19)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M273,893.5625 L273,900.0625 A3.5,3.5 0 0 0 276.5,903.5625 L283,903.5625 L273,893.5625 " fill="#FF6347" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="34" x="28" y="911.1309">Note:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="66" y="911.1309">downloadedBytes may be bigger</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="32" y="926.4414">than estimatedBytes</text><rect fill="#EEEEEE" filter="url(#f1q9by9i9niz19)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="902" x="3" y="970.8389"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="970.8389" y2="970.8389"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="973.8389" y2="973.8389"/><rect fill="#EEEEEE" filter="url(#f1q9by9i9niz19)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="151" x="378.5" y="960.1836"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="384.5" y="976.752">Download complete</text><polygon fill="#A80036" points="166,1010.4941,156,1014.4941,166,1018.4941,162,1014.4941" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="583" y1="1014.4941" y2="1014.4941"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="172" y="1010.0625">onAssetInfoUpdated(entryId, assetInfo[</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="418" y="1010.0625">completed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="489" y="1010.0625">])</text><!--
@startuml Download

skinparam backgroundColor transparent
skinparam roundCorner 14
skinparam NoteBackgroundColor #ffff00


participant App #lightcyan
participant OfflineManager as Offline
participant OVPMediaOptions as MOP
participant MediaPrefs

== Add new entry ==
App->MOP: new(entryId, ks)
App->MOP: loadMedia(url, pid)
note over MOP: Contacts **Kaltura API**
return mediaEntry
App->Offline: addAsset(mediaEntry)
note over Offline: Selects a MediaSource that matches the device

== Set media prefs and load asset info ==
note over App: Set media download prefs

App->App: prefs = new MediaPrefs(videoBitrate, videoHeight, videoWidth,\n audioLangs, textLangs)


App->Offline: loadAssetDownloadInfo(entryId, prefs)
note over Offline: Contacts **Content Host**
note over Offline: Extracts available tracks, applies MediaPrefs

Offline->App: onTracksAvailable(entryId, available, selected, selector)
note over App: Inspect //available// and //selected//, optionally\n return a selection map
App->Offline: selectedTracksMap

Offline->App: onAssetInfoUpdated(entryId, assetInfo[**metadataLoaded**])
note over App: Now AssetInfo is updated with estimated\n size based on track selection

== Start the download ==
App->Offline: startAsset(entryId)
Offline->App: onAssetInfoUpdated(entryId, assetInfo[**started**])

loop downloading
Offline->App: onDownloadProgress(entryId, downloadedBytes, estimatedBytes)
note over App #tomato: **Note:** downloadedBytes may be bigger\n than estimatedBytes
end

== Download complete ==
Offline->App: onAssetInfoUpdated(entryId, assetInfo[**completed**])

@enduml

PlantUML version 1.2018.01(Sun Jan 28 20:08:22 IST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-915-b08
Operating System: Mac OS X
OS Version: 10.13.3
Default Encoding: US-ASCII
Language: en
Country: IL
--></g></svg>