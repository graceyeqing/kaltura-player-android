<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1103px" preserveAspectRatio="none" style="width:917px;height:1103px;" version="1.1" viewBox="0 0 917 1103" width="917px" zoomAndPan="magnify"><defs><filter height="300%" id="f12xe8250ij47j" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="398.5" y="23.5352">Download Flow</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="155" x2="155" y1="68.9766" y2="1063.293"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="584" x2="584" y1="68.9766" y2="1063.293"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="726" x2="726" y1="68.9766" y2="1063.293"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="853" x2="853" y1="68.9766" y2="1063.293"/><rect fill="#E0FFFF" filter="url(#f12xe8250ij47j)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="132" y="33.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="139" y="54.0234">App</text><rect fill="#E0FFFF" filter="url(#f12xe8250ij47j)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="132" y="1062.293"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="139" y="1082.8281">App</text><rect fill="#FEFECE" filter="url(#f12xe8250ij47j)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="522" y="33.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="529" y="54.0234">OfflineManager</text><rect fill="#FEFECE" filter="url(#f12xe8250ij47j)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="522" y="1062.293"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="529" y="1082.8281">OfflineManager</text><rect fill="#FEFECE" filter="url(#f12xe8250ij47j)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="137" x="656" y="33.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="663" y="54.0234">OVPMediaOptions</text><rect fill="#FEFECE" filter="url(#f12xe8250ij47j)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="137" x="656" y="1062.293"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="663" y="1082.8281">OVPMediaOptions</text><rect fill="#FEFECE" filter="url(#f12xe8250ij47j)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="807" y="33.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="814" y="54.0234">MediaPrefs</text><rect fill="#FEFECE" filter="url(#f12xe8250ij47j)" height="30.4883" rx="7" ry="7" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="807" y="1062.293"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="814" y="1082.8281">MediaPrefs</text><rect fill="#EEEEEE" filter="url(#f12xe8250ij47j)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="902" x="3" y="99.6318"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="99.6318" y2="99.6318"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="102.6318" y2="102.6318"/><rect fill="#EEEEEE" filter="url(#f12xe8250ij47j)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="118" x="395" y="88.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="401" y="105.5449">Add new entry</text><polygon fill="#A80036" points="714.5,139.2871,724.5,143.2871,714.5,147.2871,718.5,143.2871" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="720.5" y1="143.2871" y2="143.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="162" y="138.8555">new(entryId, ks)</text><polygon fill="#A80036" points="714.5,168.5977,724.5,172.5977,714.5,176.5977,718.5,172.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="720.5" y1="172.5977" y2="172.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="162" y="168.166">loadMedia(url, pid)</text><path d="M646,192.9082 L646,203.9082 A7,7 0 0 0 653,210.9082 L795,210.9082 A7,7 0 0 0 802,203.9082 L802,195.9082 L792,185.9082 L653,185.9082 A7,7 0 0 0 646,192.9082 " fill="#FFFF00" filter="url(#f12xe8250ij47j)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M792,185.9082 L792,192.4082 A3.5,3.5 0 0 0 795.5,195.9082 L802,195.9082 L792,185.9082 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="652" y="203.4766">Contacts</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="75" x="712" y="203.4766">Kaltura API</text><polygon fill="#A80036" points="166,237.2188,156,241.2188,166,245.2188,162,241.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="160" x2="725.5" y1="241.2188" y2="241.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="172" y="236.7871">mediaEntry</text><polygon fill="#A80036" points="572,266.5293,582,270.5293,572,274.5293,576,270.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="578" y1="270.5293" y2="270.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="162" y="266.0977">addAsset(mediaEntry)</text><path d="M425,290.8398 L425,301.8398 A7,7 0 0 0 432,308.8398 L731,308.8398 A7,7 0 0 0 738,301.8398 L738,293.8398 L728,283.8398 L432,283.8398 A7,7 0 0 0 425,290.8398 " fill="#FFFF00" filter="url(#f12xe8250ij47j)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M728,283.8398 L728,290.3398 A3.5,3.5 0 0 0 731.5,293.8398 L738,293.8398 L728,283.8398 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="431" y="301.4082">Selects a MediaSource that matches the device</text><rect fill="#EEEEEE" filter="url(#f12xe8250ij47j)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="902" x="3" y="338.8057"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="338.8057" y2="338.8057"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="341.8057" y2="341.8057"/><rect fill="#EEEEEE" filter="url(#f12xe8250ij47j)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="255" x="326.5" y="328.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="237" x="332.5" y="344.7188">Set media prefs and load asset info</text><path d="M61,373.4609 L61,384.4609 A7,7 0 0 0 68,391.4609 L237,391.4609 A7,7 0 0 0 244,384.4609 L244,376.4609 L234,366.4609 L68,366.4609 A7,7 0 0 0 61,373.4609 " fill="#FFFF00" filter="url(#f12xe8250ij47j)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M234,366.4609 L234,372.9609 A3.5,3.5 0 0 0 237.5,376.4609 L244,376.4609 L234,366.4609 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="67" y="384.0293">Set media download prefs</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="197" y1="437.3926" y2="437.3926"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="197" x2="197" y1="437.3926" y2="450.3926"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="156" x2="197" y1="450.3926" y2="450.3926"/><polygon fill="#A80036" points="166,446.3926,156,450.3926,166,454.3926,162,450.3926" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="391" x="162" y="417.3398">prefs = new MediaPrefs(videoBitrate, videoHeight, videoWidth,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="166" y="432.6504">audioLangs, textLangs)</text><polygon fill="#A80036" points="572,475.3926,582,479.3926,572,483.3926,576,479.3926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="578" y1="479.3926" y2="479.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="162" y="474.9609">loadAssetDownloadInfo(entryId, prefs)</text><path d="M498,499.7031 L498,510.7031 A7,7 0 0 0 505,517.7031 L659,517.7031 A7,7 0 0 0 666,510.7031 L666,502.7031 L656,492.7031 L505,492.7031 A7,7 0 0 0 498,499.7031 " fill="#FFFF00" filter="url(#f12xe8250ij47j)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M656,492.7031 L656,499.2031 A3.5,3.5 0 0 0 659.5,502.7031 L666,502.7031 L656,492.7031 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="504" y="510.2715">Contacts</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="564" y="510.2715">Content Host</text><path d="M432,539.0137 L432,550.0137 A7,7 0 0 0 439,557.0137 L724,557.0137 A7,7 0 0 0 731,550.0137 L731,542.0137 L721,532.0137 L439,532.0137 A7,7 0 0 0 432,539.0137 " fill="#FFFF00" filter="url(#f12xe8250ij47j)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M721,532.0137 L721,538.5137 A3.5,3.5 0 0 0 724.5,542.0137 L731,542.0137 L721,532.0137 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="438" y="549.582">Extracts available tracks, applies MediaPrefs</text><polygon fill="#A80036" points="166,583.3242,156,587.3242,166,591.3242,162,587.3242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="583" y1="587.3242" y2="587.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="172" y="582.8926">onTracksAvailable(entryId, available, selected, selector)</text><path d="M13,607.6348 L13,633.6348 A7,7 0 0 0 20,640.6348 L286,640.6348 A7,7 0 0 0 293,633.6348 L293,610.6348 L283,600.6348 L20,600.6348 A7,7 0 0 0 13,607.6348 " fill="#FFFF00" filter="url(#f12xe8250ij47j)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M283,600.6348 L283,607.1348 A3.5,3.5 0 0 0 286.5,610.6348 L293,610.6348 L283,600.6348 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="19" y="618.2031">Inspect</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="55" x="69" y="618.2031">available</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="128" y="618.2031">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="52" x="155" y="618.2031">selected</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="207" y="618.2031">, optionally</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="23" y="633.5137">return a selection map</text><polygon fill="#A80036" points="572,667.2559,582,671.2559,572,675.2559,576,671.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="578" y1="671.2559" y2="671.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="162" y="666.8242">selectedTracksMap</text><polygon fill="#A80036" points="166,696.5664,156,700.5664,166,704.5664,162,700.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="583" y1="700.5664" y2="700.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="172" y="696.1348">onAssetInfoUpdated(entryId, assetInfo[</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="418" y="696.1348">metadataLoaded</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="532" y="696.1348">])</text><path d="M13,720.877 L13,746.877 A7,7 0 0 0 20,753.877 L286,753.877 A7,7 0 0 0 293,746.877 L293,723.877 L283,713.877 L20,713.877 A7,7 0 0 0 13,720.877 " fill="#FFFF00" filter="url(#f12xe8250ij47j)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M283,713.877 L283,720.377 A3.5,3.5 0 0 0 286.5,723.877 L293,723.877 L283,713.877 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="19" y="731.4453">Now AssetInfo is updated with estimated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="23" y="746.7559">size based on track selection</text><rect fill="#EEEEEE" filter="url(#f12xe8250ij47j)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="902" x="3" y="784.1533"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="784.1533" y2="784.1533"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="787.1533" y2="787.1533"/><rect fill="#EEEEEE" filter="url(#f12xe8250ij47j)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="145" x="381.5" y="773.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="387.5" y="790.0664">Start the download</text><polygon fill="#A80036" points="572,823.8086,582,827.8086,572,831.8086,576,827.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155" x2="578" y1="827.8086" y2="827.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="162" y="823.377">startAsset(entryId)</text><polygon fill="#A80036" points="166,853.1191,156,857.1191,166,861.1191,162,857.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="583" y1="857.1191" y2="857.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="172" y="852.6875">onAssetInfoUpdated(entryId, assetInfo[</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="48" x="418" y="852.6875">started</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="466" y="852.6875">])</text><path d="M19,872.4297 L86,872.4297 L86,879.4297 L76,889.4297 L12,889.4297 L12,879.4297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="101.2422" rx="7" ry="7" style="stroke: #000000; stroke-width: 2.0;" width="644" x="12" y="872.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="27" y="885.998">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="101" y="885.0645">[downloading]</text><polygon fill="#A80036" points="166,906.7402,156,910.7402,166,914.7402,162,910.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="583" y1="910.7402" y2="910.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="405" x="172" y="906.3086">onDownloadProgress(entryId, downloadedBytes, estimatedBytes)</text><path d="M22,931.0508 L22,957.0508 A7,7 0 0 0 29,964.0508 L276,964.0508 A7,7 0 0 0 283,957.0508 L283,934.0508 L273,924.0508 L29,924.0508 A7,7 0 0 0 22,931.0508 " fill="#FF6347" filter="url(#f12xe8250ij47j)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M273,924.0508 L273,930.5508 A3.5,3.5 0 0 0 276.5,934.0508 L283,934.0508 L273,924.0508 " fill="#FF6347" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="34" x="28" y="941.6191">Note:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="66" y="941.6191">downloadedBytes may be bigger</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="32" y="956.9297">than estimatedBytes</text><rect fill="#EEEEEE" filter="url(#f12xe8250ij47j)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="902" x="3" y="1001.3271"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="1001.3271" y2="1001.3271"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="905" y1="1004.3271" y2="1004.3271"/><rect fill="#EEEEEE" filter="url(#f12xe8250ij47j)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="151" x="378.5" y="990.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="384.5" y="1007.2402">Download complete</text><polygon fill="#A80036" points="166,1040.9824,156,1044.9824,166,1048.9824,162,1044.9824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="160" x2="583" y1="1044.9824" y2="1044.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="172" y="1040.5508">onAssetInfoUpdated(entryId, assetInfo[</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="418" y="1040.5508">completed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="489" y="1040.5508">])</text><!--
@startuml Download
title Download Flow
skinparam backgroundColor transparent
skinparam roundCorner 14
skinparam NoteBackgroundColor #ffff00


participant App #lightcyan
participant OfflineManager as Offline
participant OVPMediaOptions as MOP
participant MediaPrefs

== Add new entry ==
App->MOP: new(entryId, ks)
App->MOP: loadMedia(url, pid)
note over MOP: Contacts **Kaltura API**
return mediaEntry
App->Offline: addAsset(mediaEntry)
note over Offline: Selects a MediaSource that matches the device

== Set media prefs and load asset info ==
note over App: Set media download prefs

App->App: prefs = new MediaPrefs(videoBitrate, videoHeight, videoWidth,\n audioLangs, textLangs)


App->Offline: loadAssetDownloadInfo(entryId, prefs)
note over Offline: Contacts **Content Host**
note over Offline: Extracts available tracks, applies MediaPrefs

Offline->App: onTracksAvailable(entryId, available, selected, selector)
note over App: Inspect //available// and //selected//, optionally\n return a selection map
App->Offline: selectedTracksMap

Offline->App: onAssetInfoUpdated(entryId, assetInfo[**metadataLoaded**])
note over App: Now AssetInfo is updated with estimated\n size based on track selection

== Start the download ==
App->Offline: startAsset(entryId)
Offline->App: onAssetInfoUpdated(entryId, assetInfo[**started**])

loop downloading
Offline->App: onDownloadProgress(entryId, downloadedBytes, estimatedBytes)
note over App #tomato: **Note:** downloadedBytes may be bigger\n than estimatedBytes
end

== Download complete ==
Offline->App: onAssetInfoUpdated(entryId, assetInfo[**completed**])

@enduml

PlantUML version 1.2018.01(Sun Jan 28 20:08:22 IST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-915-b08
Operating System: Mac OS X
OS Version: 10.13.3
Default Encoding: US-ASCII
Language: en
Country: IL
--></g></svg>